# VisionSub å¢å¼ºå‰ç«¯ç»„ä»¶ - å¼€å‘è€…æŒ‡å—

## ç›®å½•
- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [ç»„ä»¶æ¶æ„](#ç»„ä»¶æ¶æ„)
- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
- [å®‰å…¨å®ç°](#å®‰å…¨å®ç°)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æµ‹è¯•æŒ‡å—](#æµ‹è¯•æŒ‡å—)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## é¡¹ç›®æ¦‚è¿°

VisionSub æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„è§†é¢‘OCRæ¡Œé¢åº”ç”¨ç¨‹åºï¼ŒåŸºäº PyQt6 æ¡†æ¶å¼€å‘ã€‚æœ¬é¡¹ç›®å¯¹åŸæœ‰ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢å¢å¼ºï¼Œæä¾›äº†æ›´å®‰å…¨ã€æ›´é«˜æ•ˆã€æ›´ç”¨æˆ·å‹å¥½çš„å‰ç«¯ç•Œé¢ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸ¨ **ç°ä»£åŒ–UIè®¾è®¡** - é‡‡ç”¨Material Designè®¾è®¡è¯­è¨€
- ğŸ”’ **ä¼ä¸šçº§å®‰å…¨** - å…¨é¢çš„è¾“å…¥éªŒè¯å’Œæ•°æ®ä¿æŠ¤
- âš¡ **é«˜æ€§èƒ½** - ä¼˜åŒ–çš„æ¸²æŸ“å’Œå†…å­˜ç®¡ç†
- ğŸŒ™ **å¤šä¸»é¢˜æ”¯æŒ** - æ·±è‰²/æµ…è‰²/é«˜å¯¹æ¯”åº¦ä¸»é¢˜
- â™¿ **æ— éšœç¢æ”¯æŒ** - å®Œæ•´çš„é”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨æ”¯æŒ
- ğŸ”§ **å¯æ‰©å±•æ¶æ„** - æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VisionSub å‰ç«¯æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  EnhancedMain   â”‚  â”‚ EnhancedVideo   â”‚  â”‚ EnhancedOCR     â”‚ â”‚
â”‚  â”‚     Window      â”‚  â”‚     Player      â”‚  â”‚     Preview     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EnhancedSettingsâ”‚  â”‚ EnhancedSubtitleâ”‚  â”‚  Theme System   â”‚ â”‚
â”‚  â”‚     Dialog      â”‚  â”‚     Editor      â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Core Services Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Security Mgr   â”‚  â”‚  Config Mgr     â”‚  â”‚  Event System   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  PyQt6 Framework                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: PyQt6
- **UIè®¾è®¡**: Qt Designer + æ‰‹å†™ä»£ç 
- **æ ·å¼ç³»ç»Ÿ**: QSS + Qt Style Sheets
- **ä¸»é¢˜ç³»ç»Ÿ**: è‡ªå®šä¹‰ä¸»é¢˜å¼•æ“
- **å®‰å…¨åº“**: è‡ªå®šä¹‰å®‰å…¨æ¨¡å—
- **æµ‹è¯•æ¡†æ¶**: unittest + pytest

## ç»„ä»¶æ¶æ„

### 1. EnhancedMainWindow

ä¸»çª—å£ç»„ä»¶æ˜¯åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒï¼Œè´Ÿè´£åè°ƒå…¶ä»–æ‰€æœ‰ç»„ä»¶ã€‚

#### ä¸»è¦èŒè´£

- ç®¡ç†åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸ
- åè°ƒå­ç»„ä»¶äº¤äº’
- å¤„ç†èœå•å’Œå·¥å…·æ 
- ç®¡ç†çŠ¶æ€æ å’Œè¿›åº¦æ˜¾ç¤º
- å¤„ç†ä¸»é¢˜åˆ‡æ¢

#### æ ¸å¿ƒæ–¹æ³•

```python
class EnhancedMainWindow(QMainWindow):
    def __init__(self, controller):
        super().__init__()
        self.controller = controller
        self.init_ui()
        self.setup_security()
        self.setup_theme()
    
    def init_ui(self):
        """åˆå§‹åŒ–ç”¨æˆ·ç•Œé¢"""
        self.setup_menubar()
        self.setup_toolbar()
        self.setup_statusbar()
        self.setup_central_widget()
    
    def setup_security(self):
        """è®¾ç½®å®‰å…¨ç‰¹æ€§"""
        self.security_manager = SecurityManager()
        self.setup_input_validation()
        self.setup_file_security()
    
    def switch_theme(self, theme_name):
        """åˆ‡æ¢ä¸»é¢˜"""
        self.theme_system.apply_theme(theme_name)
        self.current_theme = theme_name
```

### 2. EnhancedVideoPlayer

è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶æä¾›è§†é¢‘æ’­æ”¾å’ŒROIé€‰æ‹©åŠŸèƒ½ã€‚

#### ä¸»è¦ç‰¹æ€§

- æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼
- ROIåŒºåŸŸé€‰æ‹©
- ç¼©æ”¾å’Œå¹³ç§»åŠŸèƒ½
- æ€§èƒ½ç›‘æ§è¦†ç›–å±‚
- é”®ç›˜å¿«æ·é”®æ”¯æŒ

#### æ ¸å¿ƒæ–¹æ³•

```python
class EnhancedVideoPlayer(QWidget):
    def __init__(self):
        super().__init__()
        self.init_player()
        self.setup_controls()
        self.setup_roi_selection()
        self.setup_performance_monitoring()
    
    def enable_roi_selection(self, enabled):
        """å¯ç”¨/ç¦ç”¨ROIé€‰æ‹©"""
        self.roi_selection_enabled = enabled
        self.update_cursor()
    
    def set_roi(self, rect):
        """è®¾ç½®ROIåŒºåŸŸ"""
        self.current_roi = rect
        self.update_roi_display()
    
    def update_performance_data(self, data):
        """æ›´æ–°æ€§èƒ½æ•°æ®"""
        self.performance_data = data
        self.update_performance_overlay()
```

### 3. EnhancedOCRPreview

OCRé¢„è§ˆç»„ä»¶ç”¨äºæ˜¾ç¤ºå’Œç¼–è¾‘OCRè¯†åˆ«ç»“æœã€‚

#### ä¸»è¦ç‰¹æ€§

- å®æ—¶æ–‡æœ¬é«˜äº®æ˜¾ç¤º
- ç½®ä¿¡åº¦è¿‡æ»¤
- æœç´¢å’Œæ›¿æ¢åŠŸèƒ½
- å¤šæ ¼å¼å¯¼å‡º
- ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

#### æ ¸å¿ƒæ–¹æ³•

```python
class EnhancedOCRPreview(QWidget):
    def __init__(self):
        super().__init__()
        self.init_preview()
        self.setup_search()
        self.setup_filtering()
        self.setup_export()
    
    def display_ocr_results(self, results):
        """æ˜¾ç¤ºOCRç»“æœ"""
        self.ocr_results = results
        self.update_text_display()
        self.update_statistics()
    
    def set_confidence_threshold(self, threshold):
        """è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼"""
        self.confidence_threshold = threshold
        self.filter_results()
    
    def search_text(self, text):
        """æœç´¢æ–‡æœ¬"""
        self.search_term = text
        self.highlight_search_results()
```

## å¼€å‘ç¯å¢ƒæ­å»º

### ç³»ç»Ÿè¦æ±‚

- Python 3.9+
- PyQt6 6.4.0+
- æ“ä½œç³»ç»Ÿ: Windows 10+, macOS 10.15+, Linux

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-username/VisionSub.git
cd VisionSub
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **å®‰è£…å¼€å‘ä¾èµ–**
```bash
pip install -r requirements-dev.txt
```

### å¼€å‘å·¥å…·æ¨è

- **IDE**: PyCharm Professional æˆ– VS Code
- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **ä»£ç è´¨é‡**: Black, Flake8, mypy
- **æµ‹è¯•**: pytest, pytest-cov
- **æ–‡æ¡£**: Sphinx

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. ä¸»é¢˜ç³»ç»Ÿ

#### ä¸»é¢˜é…ç½®

```python
# themes/dark_theme.py
DARK_THEME = {
    "background": "#1e1e1e",
    "foreground": "#ffffff",
    "primary": "#007acc",
    "secondary": "#3e3e42",
    "accent": "#569cd6",
    "error": "#f48771",
    "warning": "#d7ba7d",
    "success": "#4ec9b0",
    "font_family": "Segoe UI",
    "font_size": 12
}
```

#### ä¸»é¢˜åº”ç”¨

```python
class ThemeSystem:
    def __init__(self):
        self.themes = self.load_themes()
        self.current_theme = "light"
    
    def apply_theme(self, theme_name):
        """åº”ç”¨ä¸»é¢˜"""
        theme = self.themes.get(theme_name)
        if theme:
            self.current_theme = theme_name
            self.apply_styles(theme)
            self.emit_theme_changed(theme_name)
    
    def apply_styles(self, theme):
        """åº”ç”¨æ ·å¼"""
        style_sheet = self.generate_stylesheet(theme)
        QApplication.instance().setStyleSheet(style_sheet)
```

### 2. å®‰å…¨ç®¡ç†å™¨

#### è¾“å…¥éªŒè¯

```python
class SecurityManager:
    def __init__(self):
        self.validators = {
            'text': self.validate_text,
            'file_path': self.validate_file_path,
            'number': self.validate_number,
            'email': self.validate_email
        }
    
    def validate_input(self, input_type, value):
        """éªŒè¯è¾“å…¥"""
        validator = self.validators.get(input_type)
        if validator:
            return validator(value)
        return False
    
    def validate_text(self, text):
        """éªŒè¯æ–‡æœ¬è¾“å…¥"""
        if not text:
            return False
        
        # æ£€æŸ¥é•¿åº¦
        if len(text) > 1000:
            return False
        
        # æ£€æŸ¥æ¶æ„å†…å®¹
        malicious_patterns = [
            r'<script.*?>.*?</script>',
            r'javascript:',
            r'on\w+\s*=',
            r'<iframe.*?>',
            r'<object.*?>'
        ]
        
        for pattern in malicious_patterns:
            if re.search(pattern, text, re.IGNORECASE):
                return False
        
        return True
    
    def sanitize_input(self, text):
        """å‡€åŒ–è¾“å…¥"""
        # ç§»é™¤HTMLæ ‡ç­¾
        text = re.sub(r'<[^>]*>', '', text)
        
        # ç§»é™¤JavaScriptä»£ç 
        text = re.sub(r'javascript:', '', text, flags=re.IGNORECASE)
        
        # ç§»é™¤äº‹ä»¶å¤„ç†å™¨
        text = re.sub(r'on\w+\s*=', '', text, flags=re.IGNORECASE)
        
        return text.strip()
```

#### æ–‡ä»¶å®‰å…¨

```python
class FileSecurityManager:
    def __init__(self):
        self.allowed_extensions = {'.mp4', '.avi', '.mkv', '.mov', '.wmv', '.flv'}
        self.max_file_size = 1024 * 1024 * 1024  # 1GB
    
    def validate_file(self, file_path):
        """éªŒè¯æ–‡ä»¶"""
        if not os.path.exists(file_path):
            return False
        
        # æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
        ext = os.path.splitext(file_path)[1].lower()
        if ext not in self.allowed_extensions:
            return False
        
        # æ£€æŸ¥æ–‡ä»¶å¤§å°
        file_size = os.path.getsize(file_path)
        if file_size > self.max_file_size:
            return False
        
        # æ£€æŸ¥æ–‡ä»¶ç­¾å
        if not self.validate_file_signature(file_path):
            return False
        
        return True
    
    def validate_file_signature(self, file_path):
        """éªŒè¯æ–‡ä»¶ç­¾å"""
        signatures = {
            b'\x00\x00\x00\x18ftypmp42': 'mp4',
            b'\x00\x00\x00\x20ftypmp41': 'mp4',
            b'\x1aE\xdf\xa3': 'mkv',
            b'RIFF': 'avi'
        }
        
        try:
            with open(file_path, 'rb') as f:
                header = f.read(12)
            
            for signature, format_type in signatures.items():
                if header.startswith(signature):
                    return True
        except Exception:
            pass
        
        return False
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### å†…å­˜ç®¡ç†

```python
class MemoryManager:
    def __init__(self):
        self.cache = {}
        self.max_cache_size = 100
        self.cache_policy = 'lru'  # lru, fifo, lfu
    
    def cache_object(self, key, obj):
        """ç¼“å­˜å¯¹è±¡"""
        if len(self.cache) >= self.max_cache_size:
            self.evict_from_cache()
        
        self.cache[key] = {
            'object': obj,
            'timestamp': time.time(),
            'access_count': 0
        }
    
    def evict_from_cache(self):
        """ä»ç¼“å­˜ä¸­ç§»é™¤å¯¹è±¡"""
        if self.cache_policy == 'lru':
            # æœ€è¿‘æœ€å°‘ä½¿ç”¨
            oldest_key = min(self.cache.keys(), 
                            key=lambda k: self.cache[k]['timestamp'])
            del self.cache[oldest_key]
        elif self.cache_policy == 'fifo':
            # å…ˆè¿›å…ˆå‡º
            oldest_key = min(self.cache.keys(), 
                            key=lambda k: self.cache[k]['timestamp'])
            del self.cache[oldest_key]
        elif self.cache_policy == 'lfu':
            # æœ€å°‘ä½¿ç”¨
            least_used_key = min(self.cache.keys(), 
                                key=lambda k: self.cache[k]['access_count'])
            del self.cache[least_used_key]
```

#### æ¸²æŸ“ä¼˜åŒ–

```python
class OptimizedWidget(QWidget):
    def __init__(self):
        super().__init__()
        self.set_attribute(Qt.WidgetAttribute.WA_OpaquePaintEvent, True)
        self.set_attribute(Qt.WidgetAttribute.WA_NoSystemBackground, True)
        self.set_attribute(Qt.WidgetAttribute.WA_StaticContents, True)
    
    def paintEvent(self, event):
        """ä¼˜åŒ–çš„ç»˜åˆ¶äº‹ä»¶"""
        # ä½¿ç”¨åŒç¼“å†²
        if not hasattr(self, 'buffer'):
            self.buffer = QPixmap(self.size())
        
        painter = QPainter(self.buffer)
        painter.setRenderHint(QPainter.RenderHint.Antialiasing)
        
        # åªé‡ç»˜éœ€è¦æ›´æ–°çš„åŒºåŸŸ
        if event.region().isEmpty():
            self.paint_entire_widget(painter)
        else:
            self.paint_partial_widget(painter, event.region())
        
        painter.end()
        
        # å°†ç¼“å†²åŒºç»˜åˆ¶åˆ°å±å¹•
        screen_painter = QPainter(self)
        screen_painter.drawPixmap(0, 0, self.buffer)
        screen_painter.end()
```

## æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

```python
import unittest
from PyQt6.QtWidgets import QApplication
from visionsub.ui.enhanced_main_window import EnhancedMainWindow

class TestEnhancedMainWindow(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        cls.app = QApplication.instance()
        if cls.app is None:
            cls.app = QApplication(sys.argv)
    
    def setUp(self):
        self.window = EnhancedMainWindow(MockController())
    
    def tearDown(self):
        self.window.close()
    
    def test_initialization(self):
        """æµ‹è¯•åˆå§‹åŒ–"""
        self.assertIsNotNone(self.window)
        self.assertTrue(self.window.isVisible())
    
    def test_theme_switching(self):
        """æµ‹è¯•ä¸»é¢˜åˆ‡æ¢"""
        self.window.switch_theme("dark")
        self.assertEqual(self.window.current_theme, "dark")
        
        self.window.switch_theme("light")
        self.assertEqual(self.window.current_theme, "light")

if __name__ == '__main__':
    unittest.main()
```

### é›†æˆæµ‹è¯•

```python
class TestIntegration(unittest.TestCase):
    def test_ui_component_integration(self):
        """æµ‹è¯•UIç»„ä»¶é›†æˆ"""
        # åˆ›å»ºä¸»çª—å£
        main_window = EnhancedMainWindow(MockController())
        
        # åˆ›å»ºè§†é¢‘æ’­æ”¾å™¨
        video_player = EnhancedVideoPlayer()
        main_window.set_video_player(video_player)
        
        # åˆ›å»ºOCRé¢„è§ˆ
        ocr_preview = EnhancedOCRPreview()
        main_window.set_ocr_preview(ocr_preview)
        
        # æµ‹è¯•ç»„ä»¶äº¤äº’
        video_player.video_loaded.connect(ocr_preview.on_video_loaded)
        ocr_preview.text_selected.connect(main_window.on_text_selected)
        
        # éªŒè¯é›†æˆ
        self.assertTrue(main_window.video_player is video_player)
        self.assertTrue(main_window.ocr_preview is ocr_preview)
        
        main_window.close()
```

### æ€§èƒ½æµ‹è¯•

```python
import time
import psutil

class TestPerformance(unittest.TestCase):
    def test_rendering_performance(self):
        """æµ‹è¯•æ¸²æŸ“æ€§èƒ½"""
        window = EnhancedMainWindow(MockController())
        
        # æµ‹é‡æ¸²æŸ“æ—¶é—´
        start_time = time.time()
        window.show()
        window.repaint()
        end_time = time.time()
        
        render_time = end_time - start_time
        self.assertLess(render_time, 0.1)  # åº”è¯¥åœ¨100mså†…å®Œæˆ
        
        window.close()
    
    def test_memory_usage(self):
        """æµ‹è¯•å†…å­˜ä½¿ç”¨"""
        process = psutil.Process()
        initial_memory = process.memory_info().rss
        
        # åˆ›å»ºå¤šä¸ªçª—å£
        windows = []
        for _ in range(5):
            window = EnhancedMainWindow(MockController())
            windows.append(window)
        
        final_memory = process.memory_info().rss
        memory_increase = final_memory - initial_memory
        
        # éªŒè¯å†…å­˜å¢é•¿åœ¨åˆç†èŒƒå›´å†…
        self.assertLess(memory_increase, 100 * 1024 * 1024)  # åº”è¯¥å°äº100MB
        
        for window in windows:
            window.close()
```

## éƒ¨ç½²æŒ‡å—

### æ„å»ºåº”ç”¨ç¨‹åº

```bash
# ä½¿ç”¨PyInstalleræ„å»º
pyinstaller --onefile --windowed --name VisionSub \
    --icon=assets/icon.ico \
    --add-data="assets;assets" \
    --add-data="themes;themes" \
    src/main.py

# æˆ–è€…ä½¿ç”¨cx_Freeze
python setup.py build
```

### æ‰“åŒ…åˆ†å‘

```python
# setup.py
from cx_Freeze import setup, Executable

setup(
    name="VisionSub",
    version="1.0.0",
    description="Video OCR Application",
    executables=[
        Executable(
            "src/main.py",
            base="Win32GUI" if sys.platform == "win32" else None,
            icon="assets/icon.ico"
        )
    ],
    options={
        "build_exe": {
            "packages": ["PyQt6"],
            "include_files": [
                ("assets", "assets"),
                ("themes", "themes")
            ]
        }
    }
)
```

### å®‰è£…ç¨‹åºåˆ›å»º

```bash
# ä½¿ç”¨Inno Setupåˆ›å»ºWindowså®‰è£…ç¨‹åº
iscc innosetup.iss

# ä½¿ç”¨pkgbuildåˆ›å»ºmacOSå®‰è£…åŒ…
pkgbuild --component build/VisionSub.app \
         --install-location /Applications \
         --sign "Developer ID Application: Your Name" \
         VisionSub.pkg
```

## æœ€ä½³å®è·µ

### ä»£ç é£æ ¼

```python
# éµå¾ªPEP 8ä»£ç é£æ ¼
class EnhancedComponent:
    """å¢å¼ºç»„ä»¶åŸºç±»"""
    
    def __init__(self):
        super().__init__()
        self._init_ui()
        self._setup_connections()
    
    def _init_ui(self):
        """åˆå§‹åŒ–UI"""
        pass
    
    def _setup_connections(self):
        """è®¾ç½®ä¿¡å·è¿æ¥"""
        pass
    
    def _handle_error(self, error):
        """å¤„ç†é”™è¯¯"""
        logger.error(f"Error in {self.__class__.__name__}: {error}")
        self.show_error_message(str(error))
```

### é”™è¯¯å¤„ç†

```python
class SafeComponent:
    def safe_execute(self, func, *args, **kwargs):
        """å®‰å…¨æ‰§è¡Œå‡½æ•°"""
        try:
            return func(*args, **kwargs)
        except Exception as e:
            self.handle_error(e)
            return None
    
    def handle_error(self, error):
        """å¤„ç†é”™è¯¯"""
        # è®°å½•é”™è¯¯
        logger.error(f"Error: {error}", exc_info=True)
        
        # æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
        user_message = self.get_user_friendly_error(error)
        QMessageBox.warning(self, "é”™è¯¯", user_message)
    
    def get_user_friendly_error(self, error):
        """è·å–ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯"""
        error_messages = {
            "FileNotFoundError": "æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„",
            "PermissionError": "æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æƒé™",
            "ValueError": "è¾“å…¥å€¼æ— æ•ˆï¼Œè¯·æ£€æŸ¥è¾“å…¥",
            "RuntimeError": "è¿è¡Œæ—¶é”™è¯¯ï¼Œè¯·é‡è¯•"
        }
        
        error_type = type(error).__name__
        return error_messages.get(error_type, "å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·é‡è¯•")
```

### æ—¥å¿—è®°å½•

```python
import logging
from logging.handlers import RotatingFileHandler

class AppLogger:
    def __init__(self):
        self.logger = logging.getLogger('VisionSub')
        self.setup_logger()
    
    def setup_logger(self):
        """è®¾ç½®æ—¥å¿—è®°å½•å™¨"""
        self.logger.setLevel(logging.DEBUG)
        
        # æ–‡ä»¶å¤„ç†å™¨
        file_handler = RotatingFileHandler(
            'visionsub.log',
            maxBytes=10*1024*1024,  # 10MB
            backupCount=5
        )
        file_handler.setLevel(logging.DEBUG)
        
        # æ§åˆ¶å°å¤„ç†å™¨
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.INFO)
        
        # æ ¼å¼åŒ–å™¨
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        file_handler.setFormatter(formatter)
        console_handler.setFormatter(formatter)
        
        self.logger.addHandler(file_handler)
        self.logger.addHandler(console_handler)
    
    def log_security_event(self, event_type, details):
        """è®°å½•å®‰å…¨äº‹ä»¶"""
        self.logger.warning(f"Security Event: {event_type} - {details}")
    
    def log_performance_metric(self, metric_name, value):
        """è®°å½•æ€§èƒ½æŒ‡æ ‡"""
        self.logger.info(f"Performance: {metric_name} = {value}")
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å¯¼å…¥é”™è¯¯

**é—®é¢˜**: `ImportError: No module named 'PyQt6'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
pip install PyQt6
```

#### 2. æ ·å¼é—®é¢˜

**é—®é¢˜**: ä¸»é¢˜æ ·å¼ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
```python
# ç¡®ä¿æ­£ç¡®åº”ç”¨æ ·å¼
app = QApplication(sys.argv)
app.setStyle('Fusion')

# åŠ è½½æ ·å¼è¡¨
with open('themes/dark.qss', 'r') as f:
    app.setStyleSheet(f.read())
```

#### 3. å†…å­˜æ³„æ¼

**é—®é¢˜**: åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æŒç»­å¢é•¿

**è§£å†³æ–¹æ¡ˆ**:
```python
# ç¡®ä¿æ­£ç¡®æ¸…ç†èµ„æº
def cleanup(self):
    """æ¸…ç†èµ„æº"""
    self.clear_cache()
    self.disconnect_signals()
    self.deleteLater()

# ä½¿ç”¨å¼±å¼•ç”¨é¿å…å¾ªç¯å¼•ç”¨
import weakref
self.reference = weakref.ref(target_object)
```

### è°ƒè¯•æŠ€å·§

#### 1. ä½¿ç”¨è°ƒè¯•å™¨

```python
import pdb

def debug_function():
    pdb.set_trace()  # è®¾ç½®æ–­ç‚¹
    # è°ƒè¯•ä»£ç 
```

#### 2. æ€§èƒ½åˆ†æ

```python
import cProfile
import pstats

def profile_function():
    profiler = cProfile.Profile()
    profiler.enable()
    
    # è¦åˆ†æçš„ä»£ç 
    your_function()
    
    profiler.disable()
    stats = pstats.Stats(profiler)
    stats.sort_stats('cumulative')
    stats.print_stats()
```

#### 3. å†…å­˜åˆ†æ

```python
import tracemalloc

def analyze_memory():
    tracemalloc.start()
    
    # è¿è¡Œä»£ç 
    your_function()
    
    snapshot = tracemalloc.take_snapshot()
    top_stats = snapshot.statistics('lineno')
    
    for stat in top_stats[:10]:
        print(stat)
```

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [ ] ä½¿ç”¨åŒç¼“å†²å‡å°‘é—ªçƒ
- [ ] ä¼˜åŒ–ç»˜åˆ¶äº‹ä»¶ï¼Œåªé‡ç»˜å¿…è¦åŒºåŸŸ
- [ ] ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—
- [ ] å®ç°æ‡’åŠ è½½å»¶è¿ŸåŠ è½½
- [ ] ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…é˜»å¡UI
- [ ] å®šæœŸæ¸…ç†å†…å­˜å’Œç¼“å­˜
- [ ] ä¼˜åŒ–å›¾ç‰‡å’Œèµ„æºåŠ è½½
- [ ] ä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·åˆ†æç“¶é¢ˆ

### å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯å’Œå‡€åŒ–
- [ ] æ–‡ä»¶ä¸Šä¼ æœ‰ç±»å‹å’Œå¤§å°é™åˆ¶
- [ ] è·¯å¾„éå†æ”»å‡»é˜²æŠ¤
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSæ”»å‡»é˜²æŠ¤
- [ ] æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åœ¨æ—¥å¿—ä¸­
- [ ] é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
- [ ] å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡

## ç»“è¯­

æœ¬å¼€å‘è€…æŒ‡å—æä¾›äº†VisionSubå¢å¼ºå‰ç«¯ç»„ä»¶çš„å…¨é¢æ–‡æ¡£ã€‚é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

1. ç†è§£ç³»ç»Ÿæ¶æ„å’Œç»„ä»¶è®¾è®¡
2. æ­£ç¡®è®¾ç½®å¼€å‘ç¯å¢ƒ
3. å®ç°å®‰å…¨å’Œé«˜æ€§èƒ½çš„UIç»„ä»¶
4. ç¼–å†™å’Œè¿è¡Œæµ‹è¯•
5. éƒ¨ç½²å’Œåˆ†å‘åº”ç”¨ç¨‹åº

å¦‚éœ€æ›´å¤šå¸®åŠ©ï¼Œè¯·å‚è€ƒé¡¹ç›®Wikiæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-08-15  
**ä½œè€…**: Agions  
**è®¸å¯è¯**: MIT